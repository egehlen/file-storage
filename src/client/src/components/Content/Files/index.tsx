import Commandbar from "components/Content/CommandBar";
import FileList from "components/Content/FileList";
import Header from "components/Content/Header";
import File from "interfaces/file";
import { useEffect, useState } from "react";

function Files() {

    const [files, setFiles] = useState<File[]>([]);
    const [sorting, setSorting] = useState<string>('name-asc');
    const [loaded, setLoaded] = useState<boolean>(false);
    const [deleteModalVisible, setDeleteModalVisible] = useState<boolean>(false);

    const customSort: any = {
        default: (f: File[]) => f.sort((a, b) => a.name.localeCompare(b.name)),
        'name-asc': (f: File[]) => f.sort((a, b) => a.name.localeCompare(b.name)),
        'name-desc': (f: File[]) => f.sort((a, b) => b.name.localeCompare(a.name)),
        'size-asc': (f: File[]) => f.sort((a, b) => a.size - b.size),
        'size-desc': (f: File[]) =>  f.sort((a, b) => b.size - a.size)
    };

    useEffect(() => {
        loadUserFiles();
    }, []);

    async function loadUserFiles() {
        setLoaded(false);

        let fileList : File[] = [
            {
                name: 'my-imagefile.jpg',
                hash: '123',
                type: 'image/jpeg',
                size: 102400,
                thumbnail: Buffer.from([255,216,255,219,0,67,0,6,4,5,6,5,4,6,6,5,6,7,7,6,8,10,16,10,10,9,9,10,20,14,15,12,16,23,20,24,24,23,20,22,22,26,29,37,31,26,27,35,28,22,22,32,44,32,35,38,39,41,42,41,25,31,45,48,45,40,48,37,40,41,40,255,219,0,67,1,7,7,7,10,8,10,19,10,10,19,40,26,22,26,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,255,192,0,17,8,0,120,0,180,3,1,34,0,2,17,1,3,17,1,255,196,0,27,0,0,2,2,3,1,0,0,0,0,0,0,0,0,0,0,0,3,4,0,5,1,2,6,7,255,196,0,54,16,0,2,1,3,2,5,2,4,3,8,2,3,0,0,0,0,1,2,3,0,4,17,18,33,5,19,49,65,81,34,97,6,50,113,129,20,145,177,21,35,66,82,161,193,209,225,7,98,52,178,241,255,196,0,24,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,255,196,0,33,17,0,2,2,2,2,3,1,1,1,0,0,0,0,0,0,0,0,1,2,17,18,33,3,49,19,65,81,34,177,209,255,218,0,12,3,1,0,2,17,3,17,0,63,0,175,132,159,52,220,100,208,162,132,228,83,176,193,184,174,167,4,109,25,56,166,163,201,172,164,30,212,212,48,96,110,42,26,53,143,52,117,207,122,34,65,237,70,88,124,213,41,136,183,166,81,77,98,56,176,105,164,142,128,16,6,180,113,78,8,171,71,135,218,133,17,172,140,211,28,131,226,183,88,104,5,176,106,96,129,189,56,33,219,165,106,208,208,9,55,74,19,41,171,14,70,107,6,15,106,16,171,104,205,104,98,39,181,90,152,51,88,228,123,80,21,13,17,161,188,70,173,222,15,106,19,193,237,64,82,188,70,128,209,26,186,120,61,168,15,111,237,66,81,76,98,223,165,74,180,54,251,212,161,40,78,43,126,155,83,177,65,140,109,70,142,33,77,197,23,181,11,64,98,134,154,142,42,52,112,211,41,21,10,1,35,192,233,69,88,189,168,235,31,181,25,16,80,162,235,16,163,44,116,125,24,21,48,5,1,160,74,207,44,26,201,149,115,140,138,139,58,103,5,134,77,66,154,114,43,34,28,26,36,179,42,41,36,237,72,63,19,139,108,48,223,97,239,66,13,152,197,106,80,26,20,87,65,190,99,190,104,146,73,161,151,87,67,64,100,198,43,93,2,133,119,119,28,0,101,186,210,240,113,40,88,238,235,191,77,232,7,185,85,131,13,17,103,66,153,200,252,235,89,110,97,141,75,73,34,162,128,88,146,113,128,58,154,160,11,67,230,130,241,83,49,220,69,58,43,196,234,241,176,12,172,167,32,143,34,171,238,56,181,136,130,238,85,185,140,199,106,197,39,108,237,25,3,39,63,157,8,71,140,80,29,5,39,39,16,51,242,158,221,149,225,112,25,89,78,65,30,69,2,255,0,139,67,10,149,146,84,86,3,39,39,165,44,150,56,192,3,218,165,113,55,223,16,148,185,101,231,170,149,216,138,148,179,57,163,175,138,230,45,142,69,53,29,204,126,107,197,225,248,193,193,85,213,176,247,171,56,190,52,92,16,91,7,181,41,145,114,163,216,97,157,27,27,138,105,38,79,230,21,228,54,127,25,105,30,183,25,38,154,159,226,182,114,57,79,129,220,147,74,102,188,136,245,87,185,68,92,228,98,141,105,58,201,220,87,150,55,196,101,172,164,45,38,8,92,231,168,162,240,95,138,210,53,253,236,189,55,235,80,185,163,214,73,92,117,170,190,41,126,150,233,140,238,107,134,226,95,30,199,109,23,238,198,166,59,245,174,99,139,124,109,37,210,156,104,233,231,112,124,83,108,143,145,35,185,226,60,122,56,50,53,130,122,245,233,75,91,124,66,151,46,8,108,109,177,175,31,188,227,50,93,106,4,149,241,142,245,183,15,226,179,197,54,4,204,3,108,106,224,206,94,109,158,210,220,97,194,101,152,104,61,205,18,216,7,101,153,152,176,39,32,10,243,15,219,70,88,30,49,40,124,15,80,7,112,8,235,86,124,31,140,45,180,17,197,115,118,168,161,114,186,155,78,221,6,115,89,163,75,145,51,210,191,27,26,205,208,17,245,222,155,60,78,216,41,50,190,20,14,166,188,155,139,252,113,195,109,86,86,179,152,92,92,71,178,162,131,135,59,103,127,27,255,0,67,92,173,223,199,151,87,60,52,199,60,97,110,220,149,44,135,10,7,108,83,101,124,169,30,177,241,63,196,118,109,110,235,106,57,140,191,197,131,250,215,0,191,17,53,140,233,61,196,228,135,32,174,217,4,100,10,225,111,190,32,184,185,181,142,32,198,50,51,204,42,78,254,195,218,170,218,98,85,17,153,153,80,109,185,199,147,90,72,227,46,70,217,234,156,115,254,74,150,27,219,127,217,172,178,192,177,49,112,118,203,159,151,236,58,251,230,184,190,39,241,135,22,226,114,180,151,87,179,0,80,198,84,28,13,39,57,24,29,183,53,204,72,248,96,55,199,96,107,82,250,142,107,74,40,203,114,151,103,173,240,79,142,15,9,248,79,144,37,71,186,140,105,137,85,177,164,121,7,219,197,113,79,241,21,215,236,169,173,82,71,85,158,94,108,218,78,3,29,250,129,245,170,136,45,102,150,29,71,43,26,140,228,158,222,5,43,165,178,117,41,0,102,137,32,228,217,223,252,55,241,193,176,248,86,234,202,108,155,152,67,126,21,187,96,249,250,18,106,167,142,113,75,139,213,180,183,230,59,51,34,52,172,65,5,219,29,62,157,235,152,129,37,152,142,74,150,61,8,197,116,28,47,130,241,9,230,12,196,160,35,0,147,154,142,151,101,253,75,65,36,227,2,45,43,54,90,64,163,81,42,73,251,159,53,40,237,240,229,212,174,206,167,88,39,169,67,254,106,84,206,63,70,50,57,147,40,0,18,187,86,82,127,80,35,56,247,52,155,22,43,236,59,102,176,28,227,110,181,216,197,22,191,140,195,46,14,7,181,55,31,18,112,135,13,157,183,7,122,162,77,78,72,3,52,247,15,139,50,170,186,146,14,221,63,173,1,96,252,106,117,93,40,216,30,51,74,203,197,37,61,241,66,226,54,15,107,38,6,88,123,82,194,9,6,73,76,13,186,212,208,217,101,15,18,109,44,37,114,222,7,189,44,151,79,35,145,175,124,239,158,134,146,112,84,124,218,168,109,233,80,114,50,122,142,226,165,132,172,102,123,135,203,168,56,12,118,57,237,91,218,95,203,20,172,92,231,211,128,61,233,95,83,38,84,31,32,208,201,24,240,115,82,203,67,75,121,60,77,33,18,144,210,108,196,30,190,213,135,184,154,86,215,35,151,115,182,88,231,3,197,42,163,92,136,171,187,154,122,59,88,148,59,94,74,87,182,35,195,126,103,165,101,180,139,66,156,195,234,234,51,71,142,222,105,71,166,54,193,232,78,217,255,0,52,196,80,219,168,73,224,245,156,99,75,28,128,124,230,129,113,120,248,32,28,30,192,28,224,103,160,172,228,223,69,163,102,177,154,40,132,174,16,14,164,103,122,80,203,215,96,86,183,182,188,120,228,200,96,51,177,24,20,107,200,205,192,18,198,6,113,150,247,250,98,170,109,61,138,250,38,217,97,146,122,119,205,26,214,19,35,130,196,0,15,241,26,8,82,195,109,207,140,85,143,15,141,22,88,68,184,93,109,129,145,143,189,110,232,63,131,240,188,112,14,84,131,109,176,0,206,106,193,44,86,239,12,136,196,176,238,184,197,55,37,140,118,202,38,153,161,17,129,185,97,147,246,169,97,199,227,89,2,34,44,80,231,79,51,169,250,31,21,199,201,123,137,113,173,72,182,224,220,2,218,15,89,37,217,126,97,216,215,89,99,99,3,134,70,5,1,27,1,231,235,92,229,159,24,108,229,99,60,161,221,122,26,119,246,187,115,81,161,117,195,13,193,206,107,132,173,179,188,49,72,190,37,109,128,141,10,233,3,63,46,106,87,49,117,198,225,142,98,173,128,124,49,169,69,22,92,209,230,55,22,140,177,243,15,203,141,205,37,24,5,247,4,14,212,68,185,37,93,92,177,86,249,128,56,233,68,138,85,15,204,1,50,55,193,27,87,182,217,228,170,44,108,162,137,3,9,20,228,142,181,113,104,246,208,136,203,128,164,250,80,141,205,115,77,57,228,131,39,167,73,234,14,231,218,149,231,74,210,106,44,78,14,70,251,10,203,185,4,118,28,73,116,68,2,146,64,235,147,208,85,93,237,172,178,36,109,24,13,25,233,142,180,20,187,50,69,203,102,44,221,207,159,122,52,119,108,87,146,172,116,231,242,168,173,16,85,173,26,34,172,8,46,118,223,160,164,165,134,94,113,86,249,79,141,246,246,171,185,101,94,86,79,171,59,111,176,251,230,145,120,167,153,244,90,196,89,186,234,77,241,249,85,191,108,165,113,58,55,198,65,236,59,84,18,32,42,89,114,51,190,221,104,146,216,222,168,213,45,188,202,58,100,169,20,245,159,10,126,91,73,122,141,20,49,239,150,244,235,111,229,25,253,123,81,181,221,154,81,18,150,236,69,16,228,34,199,33,249,176,61,71,239,253,170,219,131,112,107,135,47,115,196,98,41,26,0,4,78,248,44,91,166,222,58,251,210,252,36,195,195,239,18,120,140,83,73,24,200,50,110,1,246,235,143,173,19,137,113,201,230,151,84,242,146,231,249,23,78,126,167,189,115,111,212,77,172,80,59,254,27,109,28,146,242,167,49,97,253,41,158,139,231,39,251,102,168,228,118,12,121,135,87,109,199,106,184,253,165,174,95,92,17,149,192,30,150,40,1,237,140,111,77,197,37,181,188,82,201,113,48,44,223,34,114,203,126,164,28,83,55,30,208,77,54,115,136,218,147,112,164,3,244,52,228,114,164,104,79,171,3,124,19,250,85,255,0,195,113,89,113,107,199,23,54,208,184,81,146,52,233,56,250,138,176,227,80,112,251,75,93,54,220,46,38,108,236,242,46,196,119,192,206,113,239,88,151,58,82,193,162,56,222,253,28,140,83,21,155,247,72,197,73,201,108,116,172,92,200,247,51,229,155,74,227,10,72,211,77,53,194,177,37,160,183,136,3,176,82,66,254,84,123,49,106,204,121,150,194,104,188,6,43,143,189,116,114,173,209,148,168,109,225,142,75,32,27,247,139,24,217,153,207,138,163,149,154,57,22,37,25,80,65,33,69,92,113,27,187,84,83,4,49,203,30,7,69,147,167,218,170,213,167,124,176,42,171,208,103,169,255,0,53,158,54,234,205,73,166,116,86,23,211,165,158,137,138,37,176,0,97,27,73,63,238,179,23,17,9,20,137,11,196,133,198,1,29,71,222,185,118,73,11,23,149,132,106,167,109,91,147,244,20,97,163,0,139,150,66,127,152,117,251,14,213,28,80,182,53,118,179,137,142,35,141,134,1,12,100,7,62,253,106,85,133,173,183,42,4,18,113,21,82,125,64,1,157,170,86,60,181,175,244,97,35,154,141,98,48,228,231,88,234,60,138,206,168,240,64,223,59,12,117,20,168,223,25,36,14,228,209,163,133,176,100,33,138,245,200,175,81,26,54,46,223,39,92,117,205,97,93,242,115,211,197,100,148,144,131,164,3,219,29,254,181,209,112,142,21,9,128,92,95,32,64,223,39,147,244,21,153,77,65,91,32,135,12,182,146,242,72,99,133,67,74,221,65,56,24,243,93,41,248,122,40,92,155,187,168,212,128,73,211,191,255,0,62,245,142,25,197,82,41,92,91,216,24,35,32,254,241,183,102,199,158,245,95,113,198,110,110,132,206,136,22,18,48,117,38,115,246,239,94,121,79,146,79,90,70,148,85,22,49,205,194,69,170,188,104,151,7,86,159,90,140,145,231,126,213,89,61,235,180,242,11,73,154,222,14,170,145,225,1,199,114,70,245,83,41,231,72,121,100,52,167,254,160,5,31,74,53,164,72,164,188,200,147,56,35,17,134,255,0,219,182,61,169,130,91,100,123,45,109,218,226,247,19,205,41,104,147,116,118,39,57,206,78,159,243,74,72,13,243,255,0,226,201,33,201,10,93,203,3,247,233,72,94,241,121,154,86,142,37,208,128,224,32,233,79,65,44,235,10,204,210,72,146,182,192,96,97,71,114,1,239,76,101,29,151,99,17,89,76,193,209,97,84,70,95,156,2,0,246,0,245,52,179,171,75,127,50,165,168,114,48,57,175,212,129,91,79,199,57,138,34,136,202,232,190,156,140,229,206,55,36,208,191,22,242,201,25,26,34,0,100,130,115,170,162,83,237,160,244,180,49,115,104,112,36,138,24,237,209,125,39,47,154,172,47,10,48,24,87,246,41,159,234,106,238,253,76,182,202,136,2,199,32,201,151,80,80,79,125,57,237,75,27,91,62,31,19,149,152,220,75,34,144,185,27,15,52,132,181,177,86,88,195,121,5,165,148,108,159,135,18,168,26,176,116,253,255,0,213,84,241,14,36,151,215,44,209,115,164,36,140,234,192,24,246,3,111,189,41,43,131,24,222,41,20,116,202,105,199,216,245,162,90,219,220,205,27,189,186,179,149,35,126,88,194,253,170,174,53,31,211,43,109,170,54,150,222,59,121,180,220,199,23,50,65,144,11,107,42,62,157,171,54,242,199,52,170,173,52,145,174,66,134,96,1,197,86,220,67,56,145,140,160,231,179,31,31,90,45,156,118,236,117,92,76,6,216,82,91,244,21,183,29,91,102,104,176,226,9,105,26,156,59,235,213,187,29,206,49,231,166,106,142,75,249,88,144,174,113,218,172,110,173,45,96,185,84,102,28,188,2,89,137,58,190,158,40,13,10,52,186,109,16,21,61,24,238,41,10,75,233,82,66,6,234,102,216,185,43,224,211,118,86,18,220,56,195,162,30,184,45,131,249,85,141,189,136,7,78,53,224,101,138,225,112,63,189,52,97,182,180,141,101,138,34,89,179,135,11,170,146,229,93,68,213,5,88,46,162,68,65,60,100,1,176,194,237,249,212,173,162,120,230,64,252,214,4,245,24,197,74,225,127,127,134,173,125,57,91,72,57,132,179,6,42,63,149,115,78,193,107,61,204,152,69,102,63,41,200,56,174,148,61,164,41,164,32,108,17,140,244,162,175,17,88,198,84,128,71,143,210,186,203,157,190,145,150,147,237,139,112,238,9,21,166,226,62,108,189,114,195,167,218,182,190,252,127,173,222,23,45,252,58,23,56,31,157,31,246,170,59,231,111,25,241,70,78,33,152,195,15,148,121,61,171,131,148,238,216,252,149,141,45,228,75,200,208,204,8,13,234,92,31,191,189,106,246,247,68,32,17,201,203,39,0,161,198,61,197,90,11,197,100,111,74,153,14,196,156,111,89,135,136,50,62,23,1,6,122,174,49,76,229,233,13,8,37,156,234,28,139,118,105,114,6,113,182,124,251,159,127,233,89,143,133,60,113,184,88,138,146,115,164,121,166,39,226,197,116,5,108,2,119,32,212,146,248,184,70,215,190,112,125,169,148,203,113,74,145,94,56,116,195,84,191,133,148,105,56,11,228,255,0,138,120,240,199,158,49,248,152,212,103,176,29,188,102,182,154,246,97,164,234,194,227,99,230,132,188,65,159,210,205,177,193,247,20,202,111,102,45,35,41,194,37,133,90,53,10,19,182,113,159,202,137,7,3,129,37,212,70,8,27,46,188,111,75,189,249,12,50,236,84,126,64,81,35,226,42,9,102,44,7,191,106,141,242,80,205,47,67,166,198,71,152,23,88,93,99,25,140,62,224,82,210,112,227,53,211,115,216,233,24,35,66,0,185,240,63,205,104,252,72,18,95,152,50,71,159,202,134,111,30,80,164,48,57,239,239,226,162,205,17,200,45,183,8,130,43,158,124,129,27,254,153,207,220,231,161,163,78,146,242,46,32,180,88,209,24,96,12,16,75,116,6,171,218,126,98,224,48,206,124,254,181,157,103,146,52,204,21,206,253,124,85,121,123,42,228,125,20,242,216,223,172,224,27,91,134,140,224,244,39,39,198,107,45,195,230,89,192,252,19,149,56,56,35,118,207,96,58,87,65,21,235,195,18,199,251,182,39,25,96,212,35,124,68,154,91,78,143,110,213,209,115,77,250,45,162,166,91,127,198,221,141,118,178,67,24,24,61,130,227,199,250,161,205,16,183,141,164,72,153,81,70,85,134,70,77,94,27,216,85,48,131,1,124,13,134,104,114,223,68,202,161,128,101,32,156,48,4,126,85,84,229,240,100,145,205,189,195,48,89,75,176,149,143,171,193,241,79,164,192,142,92,172,194,60,177,192,216,255,0,186,177,215,109,55,88,162,4,120,92,82,247,34,216,130,21,9,193,193,25,198,213,188,211,213,19,32,106,99,210,48,142,1,27,3,191,247,169,67,145,224,70,194,234,198,60,212,169,70,243,66,70,229,217,64,206,213,171,75,46,14,123,246,169,82,187,82,71,19,8,242,46,14,79,79,184,166,34,185,145,70,55,57,242,123,84,169,81,164,202,20,74,203,146,88,244,251,214,239,58,236,75,28,143,235,82,165,98,129,167,226,0,98,70,112,127,135,181,107,248,134,32,225,177,145,211,197,74,149,113,66,205,133,195,58,169,144,248,199,189,97,110,11,28,102,165,74,148,136,141,77,193,102,5,60,84,252,70,114,173,184,239,82,165,90,68,53,73,48,78,145,215,98,43,45,51,46,85,27,31,74,149,42,214,193,5,195,13,128,39,185,205,70,147,80,36,255,0,14,42,84,165,26,232,214,54,195,146,1,35,126,181,135,157,129,200,249,69,74,148,72,26,137,78,14,8,201,233,244,168,103,0,111,146,194,165,74,180,136,96,92,16,118,36,125,171,103,185,98,7,243,99,25,169,82,152,161,70,153,206,224,143,210,165,74,148,20,127,255,217]),
                visible: true,
                selected: false,
                processing: false
            },
            {
                name: 'new_doc.pdf',
                hash: '456',
                type: 'application/pdf',
                size: 2048000,
                thumbnail: null,
                visible: true,
                selected: false,
                processing: false
            },
            {
                name: 'my-secret-file-123.zip',
                hash: '789',
                type: 'application/zip',
                size: 9850000,
                thumbnail: null,
                visible: true,
                selected: false,
                processing: false
            }
        ]; //await userFilesService.getAll();

        if (fileList && fileList.length) {
            fileList.sort((a, b) => a.name.localeCompare(b.name));
            setFiles(fileList);
        }

        setLoaded(true);
    }

    function selectionToggleSingle(hash: string) {
        if (hash) {
            let _files: File[] = [];
            _files = _files.concat(files);

            _files.forEach(file => {
                if (file.hash === hash) {
                    file.selected = !file.selected;
                }
            });

            setFiles(_files);
        }
    }

    function selectionToggleAll(selectAll: boolean) {
        let _files: File[] = [];
        _files = _files.concat(files);
        _files.forEach(file =>  file.selected = selectAll);
        setFiles(_files);
    }

    function sortFiles(event: any) {
        if (event && event.key) {
            let _files: File[] = [];
            _files = _files.concat(files);
            _files = customSort[event.key](_files) || customSort.default(_files);

            setFiles(_files);
            setSorting(event.key);
        }
    }

    function filter(query: string) {
        const emptyQuery = (query === '');

        let _files: File[] = [];
        let search = query.toLowerCase();
        _files = _files.concat(files);

        _files.forEach(file => {
            file.visible = emptyQuery ? true : ((search.trim() !== '') ? file.name.toLowerCase().startsWith(search) : true);
        });

        setFiles(_files);
    }

    function getSelectedFiles() {
        return files.filter(file => file.selected);
    }

    return (
        <>
            <Header onFilter={filter} />
            <Commandbar
                title="My Files"
                selectedCount={getSelectedFiles().length}
                totalCount={files.length}
                onDeleteRequest={() => {}}
                onSelectionToggleAll={selectionToggleAll}
            />
            <FileList
                files={files}
                loaded={loaded}
                onSelectionToggleSingle={selectionToggleSingle}
            />
        </>
    );
}

export default Files;